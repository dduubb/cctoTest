<!-- Tableau Viz HTML-->
<h1 name="_tablow-dashboard" id="_tablow-dashboard">Collections Dashboard</h1>
<tableau-viz
    data-viz-name="2023TaxBillAnalysis/HistoricTotal"
    device="desktop"
    hide-tabs
    toolbar="bottom">
</tableau-viz>
<!-- End Tableau Viz HTML-->

<!-- Necessary Script for Tableau Viz -->
<script type="module">
    // Import the Tableau Embedding API components
    import { TableauEventType } from 'https://public.tableau.com/javascripts/api/tableau.embedding.3.7.0.js';

    async function initializeViz() {
        // Get the viz object from the HTML web component
        const viz = document.querySelector('tableau-viz');
        const vizName = viz.getAttribute('data-viz-name');
        viz.src = `https://public.tableau.com/views/${vizName}?:language=en-US&:display_count=n&:origin=viz_share_link`;

        try {
            await new Promise((resolve, reject) => {
                setDeviceType();
                // Add an event listener to verify the viz becomes interactive
                viz.addEventListener(TableauEventType.FirstInteractive, () => {
                    resolve();
                });

                // Optional: reject the promise if not resolved within a timeout
                setTimeout(() => reject(new Error('Viz did not become interactive in time')), 10000);
            });
        } catch (error) {
            console.error('Failed to initialize Tableau Viz:', error);
        }
    }

    function setDeviceType() {
        const isMobile = /Android|webOS|iPhone|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const tableauViz = document.querySelector("tableau-viz");
        if (isMobile) {
            console.log("Mobile device detected");
            tableauViz.style.height = "1250px";
            tableauViz.setAttribute("device", "phone");
        } else {
            console.log("Desktop device detected");
            tableauViz.style.height = "100%";
            tableauViz.style.overflowY = "hidden";
            tableauViz.style.height = "750px";
            tableauViz.setAttribute("device", "desktop");
        }
    }

    // Call the async function to initialize the viz
    initializeViz();
</script>
<!-- End Necessary Script for Tableau Viz -->
